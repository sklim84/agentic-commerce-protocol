{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/agentic-checkout/bundle.schema.json",
  "title": "Agentic Checkout \u2014 Schema Bundle",
  "$defs": {
    "VariantOption": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string" },
        "value": { "type": "string" }
      },
      "required": ["name", "value"]
    },
    "WeightInfo": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "value": { "type": "number" },
        "unit": { "type": "string", "enum": ["g", "kg", "oz", "lb"] }
      },
      "required": ["value", "unit"]
    },
    "DimensionsInfo": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "length": { "type": "number" },
        "width": { "type": "number" },
        "height": { "type": "number" },
        "unit": { "type": "string", "enum": ["cm", "in"] }
      },
      "required": ["length", "width", "height", "unit"]
    },
    "DiscountDetail": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "code": { "type": "string" },
        "type": { "type": "string", "enum": ["percentage", "fixed", "bogo", "volume"] },
        "amount": { "type": "integer" },
        "description": { "type": "string" },
        "source": { "type": "string", "enum": ["coupon", "automatic", "loyalty"] }
      },
      "required": ["type", "amount"]
    },
    "Address": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string"
        },
        "line_one": {
          "type": "string"
        },
        "line_two": {
          "type": "string"
        },
        "city": {
          "type": "string"
        },
        "state": {
          "type": "string"
        },
        "country": {
          "type": "string"
        },
        "postal_code": {
          "type": "string"
        }
      },
      "required": [
        "name",
        "line_one",
        "city",
        "state",
        "country",
        "postal_code"
      ]
    },
    "AffiliateAttributionSource": {
      "type": "object",
      "additionalProperties": false,
      "description": "Context about where the attribution originated.",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["url", "platform", "unknown"],
          "description": "The type of attribution source."
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "Canonical content URL when type is 'url'."
        }
      },
      "required": ["type"]
    },
    "AffiliateAttributionMetadata": {
      "type": "object",
      "additionalProperties": {
        "oneOf": [
          { "type": "string" },
          { "type": "number" },
          { "type": "boolean" }
        ]
      },
      "description": "Flat key/value map for additional non-sensitive context. Keys must be strings; values must be strings, numbers, or booleans. Arrays and nested objects are NOT permitted."
    },
    "AffiliateAttribution": {
      "type": "object",
      "description": "Optional affiliate attribution data for crediting third-party publishers. Write-only: not returned in responses. Forward compatibility: Servers SHOULD ignore unknown fields to support future extensions (per RFC ยง8.2).",
      "properties": {
        "provider": {
          "type": "string",
          "description": "Identifier for the attribution provider / affiliate network namespace (e.g., 'impact.com')."
        },
        "token": {
          "type": "string",
          "description": "Opaque provider-issued token for fraud-resistant validation. Treat as secret."
        },
        "publisher_id": {
          "type": "string",
          "description": "Provider-scoped affiliate/publisher identifier. Required if token is omitted."
        },
        "campaign_id": {
          "type": "string",
          "description": "Provider-scoped campaign identifier."
        },
        "creative_id": {
          "type": "string",
          "description": "Provider-scoped creative identifier."
        },
        "sub_id": {
          "type": "string",
          "description": "Provider-scoped sub-tracking identifier."
        },
        "source": {
          "$ref": "#/$defs/AffiliateAttributionSource"
        },
        "issued_at": {
          "type": "string",
          "format": "date-time",
          "description": "RFC3339 timestamp when the attribution token was issued."
        },
        "expires_at": {
          "type": "string",
          "format": "date-time",
          "description": "RFC3339 timestamp when the attribution token expires."
        },
        "metadata": {
          "$ref": "#/$defs/AffiliateAttributionMetadata"
        },
        "touchpoint": {
          "type": "string",
          "enum": ["first", "last"],
          "description": "Attribution touchpoint type. Use 'first' when capturing at session creation, 'last' when capturing at completion. Enables multi-touch attribution models."
        }
      },
      "required": ["provider"],
      "anyOf": [{ "required": ["token"] }, { "required": ["publisher_id"] }]
    },
    "FulfillmentDetails": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string"
        },
        "phone_number": {
          "type": "string"
        },
        "email": {
          "type": "string",
          "format": "email"
        },
        "address": {
          "$ref": "#/$defs/Address"
        }
      }
    },
    "CompanyInfo": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string" },
        "tax_id": { "type": "string" },
        "department": { "type": "string" },
        "cost_center": { "type": "string" }
      },
      "required": ["name"]
    },
    "LoyaltyInfo": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "tier": { "type": "string" },
        "points_balance": { "type": "integer" },
        "member_since": { "type": "string", "format": "date-time" }
      }
    },
    "TaxExemption": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "certificate_id": { "type": "string" },
        "certificate_type": { "type": "string", "enum": ["resale", "exempt_organization", "government"] },
        "exempt_regions": {
          "type": "array",
          "items": { "type": "string" }
        },
        "expires_at": { "type": "string", "format": "date-time" }
      },
      "required": ["certificate_id", "certificate_type"]
    },
    "Buyer": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "first_name": {
          "type": "string"
        },
        "last_name": {
          "type": "string"
        },
        "full_name": {
          "type": "string"
        },
        "email": {
          "type": "string",
          "format": "email"
        },
        "phone_number": {
          "type": "string"
        },
        "customer_id": { "type": "string" },
        "account_type": { "type": "string", "enum": ["guest", "registered", "business"] },
        "authentication_status": { "type": "string", "enum": ["authenticated", "guest", "requires_signin"] },
        "company": { "$ref": "#/$defs/CompanyInfo" },
        "loyalty": { "$ref": "#/$defs/LoyaltyInfo" },
        "tax_exemption": { "$ref": "#/$defs/TaxExemption" }
      },
      "required": ["email"]
    },
    "InterventionCapabilities": {
      "type": "object",
      "additionalProperties": false,
      "description": "Intervention capabilities. Context-specific fields: display_context, redirect_context, max_redirects, max_interaction_depth (requests only). required, enforcement (responses only). supported field contains intersection in responses.",
      "properties": {
        "supported": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["3ds", "biometric", "address_verification"]
          },
          "description": "Intervention types supported. Agent request: Interventions the agent can handle. Seller response: Intersection of supported interventions."
        },
        "required": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["3ds", "biometric"]
          },
          "description": "Intervention methods required for this session (seller only)."
        },
        "enforcement": {
          "type": "string",
          "enum": ["always", "conditional", "optional"],
          "description": "When required interventions are enforced (seller only)."
        },
        "display_context": {
          "type": "string",
          "enum": ["native", "webview", "modal", "redirect"],
          "description": "How the Agent presents interventions (agent only)."
        },
        "redirect_context": {
          "type": "string",
          "enum": ["in_app", "external_browser", "none"],
          "description": "How the Agent handles redirects (agent only)."
        },
        "max_redirects": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum number of redirects the Agent can handle (agent only)."
        },
        "max_interaction_depth": {
          "type": "integer",
          "minimum": 1,
          "description": "Maximum depth of nested interactions the Agent can handle (agent only)."
        }
      }
    },
    "Capabilities": {
      "type": "object",
      "additionalProperties": false,
      "description": "Capabilities object used in requests and responses. Context determines the party: requests are from Agents, responses are from Sellers. Seller responses contain the intersection of supported interventions.",
      "properties": {
        "payment_methods": {
          "type": "array",
          "items": {
            "oneOf": [
              { "type": "string" },
              { "$ref": "#/$defs/PaymentMethodObject" }
            ]
          },
          "description": "Payment methods accepted by the Seller for this session (responses only). Can be simple strings or objects with constraints (e.g., card brands)."
        },
        "interventions": {
          "$ref": "#/$defs/InterventionCapabilities"
        }
      }
    },
    "PaymentMethodObject": {
      "type": "object",
      "additionalProperties": false,
      "description": "Payment method with additional constraints (e.g., card brands, PSP routing)",
      "properties": {
        "method": {
          "type": "string",
          "description": "The payment method identifier"
        },
        "brands": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["visa", "mastercard", "amex", "discover", "diners", "jcb", "unionpay", "eftpos", "interac"]
          },
          "description": "Specific card brands/networks accepted"
        },
        "funding_types": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["credit", "debit", "prepaid"]
          },
          "description": "For card methods, funding types accepted"
        },
        "providers": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Optional PSP routing information"
        }
      },
      "required": ["method"]
    },
    "Item": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "unit_amount": {
          "type": "integer"
        }
      },
      "required": ["id"]
    },
    "Disclosure": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": ["disclaimer"]
        },
        "content_type": {
          "type": "string",
          "enum": ["plain", "markdown"]
        },
        "content": {
          "type": "string"
        }
      },
      "required": ["type", "content_type", "content"]
    },
    "CustomAttribute": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "display_name": {
          "type": "string"
        },
        "value": {
          "type": "string"
        }
      },
      "required": ["display_name", "value"]
    },
    "MarketplaceSellerDetails": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string"
        }
      },
      "required": ["name"]
    },
    "PaymentMethod": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": ["card"]
        },
        "supported_card_networks": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["amex", "discover", "mastercard", "visa"]
          }
        }
      },
      "required": ["type"]
    },
    "PaymentProvider": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["stripe"]
        },
        "supported_payment_methods": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/PaymentMethod"
          }
        }
      },
      "required": ["provider", "supported_payment_methods"]
    },
    "LineItem": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string"
        },
        "item": {
          "$ref": "#/$defs/Item"
        },
        "quantity": {
          "type": "integer",
          "minimum": 1
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "images": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uri"
          }
        },
        "unit_amount": {
          "type": "integer",
          "description": "The unit price of the line item in the smallest currency unit (e.g., cents for USD)"
        },
        "disclosures": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Disclosure"
          }
        },
        "custom_attributes": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/CustomAttribute"
          }
        },
        "marketplace_seller_details": {
          "$ref": "#/$defs/MarketplaceSellerDetails"
        },
        "product_id": { "type": "string" },
        "sku": { "type": "string" },
        "variant_id": { "type": "string" },
        "category": { "type": "string" },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        },
        "weight": { "$ref": "#/$defs/WeightInfo" },
        "dimensions": { "$ref": "#/$defs/DimensionsInfo" },
        "availability_status": {
          "type": "string",
          "enum": ["in_stock", "low_stock", "out_of_stock", "backorder", "pre_order"]
        },
        "available_quantity": { "type": "integer", "minimum": 0 },
        "max_quantity_per_order": { "type": "integer", "minimum": 1 },
        "fulfillable_on": { "type": "string", "format": "date-time" },
        "variant_options": {
          "type": "array",
          "items": { "$ref": "#/$defs/VariantOption" }
        },
        "discount_details": {
          "type": "array",
          "items": { "$ref": "#/$defs/DiscountDetail" }
        },
        "tax_exempt": { "type": "boolean" },
        "tax_exemption_reason": { "type": "string" },
        "parent_id": { "type": "string", "description": "Reference to parent line item for bundled products" },
        "totals": {
          "type": "array",
          "items": { "$ref": "#/$defs/Total" },
          "description": "Line-item level totals breakdown including base_amount, discount, subtotal, tax, and total"
        }
      },
      "required": [
        "id",
        "item",
        "quantity",
        "totals"
      ]
    },
    "TaxBreakdownItem": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "jurisdiction": { "type": "string" },
        "rate": { "type": "number" },
        "amount": { "type": "integer" }
      },
      "required": ["jurisdiction", "rate", "amount"]
    },
    "Total": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "items_base_amount",
            "items_discount",
            "subtotal",
            "discount",
            "fulfillment",
            "tax",
            "fee",
            "gift_wrap",
            "tip",
            "store_credit",
            "total"
          ]
        },
        "display_text": {
          "type": "string"
        },
        "amount": {
          "type": "integer"
        },
        "presentment_amount": { "type": "integer" },
        "description": {
          "type": "string"
        },
        "breakdown": {
          "type": "array",
          "items": { "$ref": "#/$defs/TaxBreakdownItem" }
        }
      },
      "required": ["type", "display_text", "amount"]
    },
    "FulfillmentOptionPickup": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "type": "string", "const": "pickup" },
        "id": { "type": "string" },
        "title": { "type": "string" },
        "description": { "type": "string" },
        "location": {
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "address": { "$ref": "#/$defs/Address" },
            "phone": { "type": "string" },
            "instructions": { "type": "string" }
          },
          "required": ["name", "address"]
        },
        "pickup_type": { "type": "string", "enum": ["in_store", "curbside", "locker"] },
        "ready_by": { "type": "string", "format": "date-time" },
        "pickup_by": { "type": "string", "format": "date-time" },
        "totals": {
          "type": "array",
          "items": { "$ref": "#/$defs/Total" }
        }
      },
      "required": ["type", "id", "title", "location", "totals"]
    },
    "FulfillmentOptionLocalDelivery": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "type": "string", "const": "local_delivery" },
        "id": { "type": "string" },
        "title": { "type": "string" },
        "description": { "type": "string" },
        "delivery_window": {
          "type": "object",
          "properties": {
            "start": { "type": "string", "format": "date-time" },
            "end": { "type": "string", "format": "date-time" }
          },
          "required": ["start", "end"]
        },
        "service_area": {
          "type": "object",
          "properties": {
            "radius_miles": { "type": "number" },
            "center_postal_code": { "type": "string" }
          }
        },
        "totals": {
          "type": "array",
          "items": { "$ref": "#/$defs/Total" }
        }
      },
      "required": ["type", "id", "title", "totals"]
    },
    "FulfillmentOptionShipping": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "const": "shipping"
        },
        "id": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "carrier": {
          "type": "string"
        },
        "earliest_delivery_time": {
          "type": "string",
          "format": "date-time"
        },
        "latest_delivery_time": {
          "type": "string",
          "format": "date-time"
        },
        "totals": {
          "type": "array",
          "items": { "$ref": "#/$defs/Total" }
        }
      },
      "required": ["type", "id", "title", "totals"]
    },
    "FulfillmentOptionDigital": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "const": "digital"
        },
        "id": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "totals": {
          "type": "array",
          "items": { "$ref": "#/$defs/Total" }
        }
      },
      "required": ["type", "id", "title", "totals"]
    },
    "SelectedFulfillmentOption": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": ["shipping", "digital", "pickup", "local_delivery"]
        },
        "option_id": {
          "type": "string"
        },
        "item_ids": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": ["type", "option_id", "item_ids"]
    },
    "GiftWrap": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": { "type": "boolean" },
        "style": { "type": "string", "enum": ["birthday", "holiday", "elegant"] },
        "charge": { "type": "integer" }
      },
      "required": ["enabled"]
    },
    "SplitPayment": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "amount": { "type": "integer" }
      },
      "required": ["amount"]
    },
    "FulfillmentGroup": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": { "type": "string" },
        "item_ids": {
          "type": "array",
          "items": { "type": "string" }
        },
        "destination_type": { "type": "string", "enum": ["shipping", "pickup", "local_delivery", "digital"] },
        "fulfillment_details": { "$ref": "#/$defs/FulfillmentDetails" },
        "location_id": { "type": "string" },
        "instructions": { "type": "string" }
      },
      "required": ["id", "item_ids", "destination_type"]
    },
    "EstimatedDelivery": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "earliest": { "type": "string", "format": "date-time" },
        "latest": { "type": "string", "format": "date-time" }
      },
      "required": ["earliest", "latest"]
    },
    "OrderConfirmation": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "confirmation_number": { "type": "string" },
        "confirmation_email_sent": { "type": "boolean" },
        "receipt_url": { "type": "string", "format": "uri" },
        "invoice_number": { "type": "string" }
      }
    },
    "SupportInfo": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "email": { "type": "string", "format": "email" },
        "phone": { "type": "string" },
        "hours": { "type": "string" },
        "help_center_url": { "type": "string", "format": "uri" }
      }
    },
    "MessageInfo": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "type": "string", "const": "info" },
        "severity": { "type": "string", "enum": ["info", "low", "medium", "high", "critical"] },
        "param": {
          "type": "string",
          "description": "RFC 9535 JSONPath"
        },
        "content_type": {
          "type": "string",
          "enum": ["plain", "markdown"]
        },
        "content": {
          "type": "string"
        }
      },
      "required": ["type", "content_type", "content"]
    },
    "MessageWarning": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "type": "string", "const": "warning" },
        "code": {
          "type": "string",
          "enum": ["low_stock", "high_demand", "shipping_delay", "price_change", "expiring_promotion", "limited_availability"]
        },
        "severity": { "type": "string", "enum": ["info", "low", "medium", "high", "critical"] },
        "param": {
          "type": "string",
          "description": "RFC 9535 JSONPath"
        },
        "content_type": {
          "type": "string",
          "enum": ["plain", "markdown"]
        },
        "content": {
          "type": "string"
        }
      },
      "required": ["type", "code", "content_type", "content"]
    },
    "MessageError": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "const": "error"
        },
        "code": {
          "type": "string",
          "enum": [
            "missing",
            "invalid",
            "out_of_stock",
            "payment_declined",
            "requires_sign_in",
            "requires_3ds",
            "low_stock",
            "quantity_exceeded",
            "coupon_invalid",
            "coupon_expired",
            "minimum_not_met",
            "maximum_exceeded",
            "region_restricted",
            "age_verification_required",
            "approval_required",
            "unsupported",
            "not_found",
            "conflict",
            "rate_limited",
            "expired"
          ]
        },
        "severity": { "type": "string", "enum": ["info", "low", "medium", "high", "critical"] },
        "param": {
          "type": "string",
          "description": "RFC 9535 JSONPath"
        },
        "content_type": {
          "type": "string",
          "enum": ["plain", "markdown"]
        },
        "content": {
          "type": "string"
        }
      },
      "required": ["type", "code", "content_type", "content"]
    },
    "Link": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": ["terms_of_use", "privacy_policy", "return_policy", "shipping_policy", "contact_us", "about_us", "faq", "support"]
        },
        "title": { "type": "string" },
        "url": {
          "type": "string",
          "format": "uri"
        }
      },
      "required": ["type", "url"]
    },
    "PaymentData": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "token": {
          "type": "string"
        },
        "provider": {
          "type": "string",
          "enum": ["stripe"]
        },
        "billing_address": {
          "$ref": "#/$defs/Address"
        },
        "purchase_order_number": { "type": "string" },
        "payment_terms": { "type": "string", "enum": ["immediate", "net_15", "net_30", "net_60", "net_90"] },
        "due_date": { "type": "string", "format": "date-time" },
        "approval_required": { "type": "boolean" }
      },
      "anyOf": [
        { "required": ["token", "provider"] },
        { "required": ["purchase_order_number"] }
      ]
    },
    "ProtocolVersion": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "version": { "type": "string", "example": "2026-01-22" },
        "capabilities": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of supported capabilities"
        }
      },
      "required": ["version"]
    },
    "PaymentResponse": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "provider": { "type": "string" },
        "instruments": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": true
          }
        },
        "handlers": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": true
          }
        }
      }
    },
    "RiskSignals": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "ip_address": { "type": "string" },
        "user_agent": { "type": "string" },
        "accept_language": { "type": "string" },
        "session_id": { "type": "string" },
        "device_fingerprint": { "type": "string" }
      }
    },
    "Order": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string"
        },
        "checkout_session_id": {
          "type": "string"
        },
        "order_number": { "type": "string" },
        "permalink_url": {
          "type": "string",
          "format": "uri"
        },
        "status": { "type": "string", "enum": ["confirmed", "processing", "shipped", "delivered"] },
        "estimated_delivery": { "$ref": "#/$defs/EstimatedDelivery" },
        "confirmation": { "$ref": "#/$defs/OrderConfirmation" },
        "support": { "$ref": "#/$defs/SupportInfo" }
      },
      "required": ["id", "checkout_session_id", "permalink_url"]
    },
    "AuthenticationMetadata": {
      "type": "object",
      "additionalProperties": true,
      "description": "Seller-provided authentication metadata for 3DS flows.",
      "required": [
        "channel",
        "acquirer_details",
        "directory_server"
      ],
      "properties": {
        "channel": {
          "type": "object",
          "additionalProperties": false,
          "description": "Details about the channel used for this 3DS Authentication.",
          "required": [
            "type",
            "browser"
          ],
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "browser"
              ],
              "description": "Use 'browser' to indicate the transaction originated from a browser."
            },
            "browser": {
              "type": "object",
              "additionalProperties": false,
              "description": "Browser details collected server- or client-side.",
              "properties": {
                "accept_header": {
                  "type": "string",
                  "description": "The HTTP Accept header from the cardholder\u2019s browser."
                },
                "ip_address": {
                  "type": "string",
                  "maxLength": 45,
                  "description": "The IP address of the browser."
                },
                "javascript_enabled": {
                  "type": "boolean",
                  "description": "Whether the cardholder browser can execute JavaScript."
                },
                "language": {
                  "type": "string",
                  "maxLength": 35,
                  "description": "An IETF BCP 47 language tag representing the browser language."
                },
                "user_agent": {
                  "type": "string",
                  "description": "The browser user agent string."
                },
                "color_depth": {
                  "type": "integer",
                  "description": "The screen color depth. Required if javascript_enabled is true."
                },
                "java_enabled": {
                  "type": "boolean",
                  "description": "Browser Java support. Required if javascript_enabled is true."
                },
                "screen_height": {
                  "type": "integer",
                  "description": "Screen height in pixels. Required if javascript_enabled is true."
                },
                "screen_width": {
                  "type": "integer",
                  "description": "Screen width in pixels. Required if javascript_enabled is true."
                },
                "timezone_offset": {
                  "type": "integer",
                  "description": "Time difference in minutes between UTC and the browser local time. Required if javascript_enabled is true."
                }
              },
              "required": [
                "accept_header",
                "ip_address",
                "javascript_enabled",
                "language",
                "user_agent"
              ]
            }
          }
        },
        "acquirer_details": {
          "type": "object",
          "additionalProperties": false,
          "description": "Details about the acquirer used for this 3DS Authentication. This object MUST be present.",
          "properties": {
            "acquirer_bin": {
              "type": "string",
              "maxLength": 11,
              "description": "The Acquirer BIN (directory-server specific)."
            },
            "acquirer_country": {
              "type": "string",
              "minLength": 2,
              "maxLength": 2,
              "description": "Two-letter ISO 3166-1 alpha-2 country code."
            },
            "acquirer_merchant_id": {
              "type": "string",
              "maxLength": 35,
              "description": "The Merchant ID assigned by the acquirer."
            },
            "merchant_name": {
              "type": "string",
              "maxLength": 40,
              "description": "Merchant name assigned by the acquirer."
            },
            "requestor_id": {
              "type": "string",
              "maxLength": 35,
              "description": "Requestor ID (if required by the directory server)."
            }
          },
          "required": [
            "acquirer_bin",
            "acquirer_country",
            "acquirer_merchant_id",
            "merchant_name"
          ]
        },
        "directory_server": {
          "type": "string",
          "enum": [
            "american_express",
            "mastercard",
            "visa"
          ],
          "description": "The 3DS directory server used for this Authentication."
        },
        "flow_preference": {
          "type": "object",
          "additionalProperties": false,
          "description": "Contains additional details on the seller's preference for the 3DS authentication flow. Sellers MAY request a preference, but issuers ultimately decide the actual flow.",
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "challenge",
                "frictionless"
              ],
              "description": "Type of flow requested for this 3DS Authentication. 'challenge' requests a challenge flow; 'frictionless' requests a frictionless flow."
            },
            "challenge": {
              "type": "object",
              "additionalProperties": false,
              "description": "Details about the requested challenge flow.",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "mandated",
                    "preferred"
                  ],
                  "description": "Subtype of challenge preference."
                }
              }
            },
            "frictionless": {
              "type": "object",
              "additionalProperties": false,
              "description": "Details about the requested frictionless flow.",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "low_risk"
                  ],
                  "description": "Subtype of frictionless preference."
                }
              }
            }
          },
          "required": [
            "type"
          ]
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "channel": {
                "properties": {
                  "browser": {
                    "properties": {
                      "javascript_enabled": {
                        "const": true
                      }
                    }
                  }
                }
              }
            }
          },
          "then": {
            "properties": {
              "channel": {
                "properties": {
                  "browser": {
                    "required": [
                      "color_depth",
                      "java_enabled",
                      "screen_height",
                      "screen_width",
                      "timezone_offset"
                    ]
                  }
                }
              }
            }
          }
        }
      ]
    },
    "AuthenticationResult": {
      "type": "object",
      "additionalProperties": false,
      "description": "Agent-provided authentication results returned to the seller for card-based 3D Secure.",
      "properties": {
        "outcome": {
          "type": "string",
          "description": "The outcome of this 3DS Authentication.",
          "enum": [
            "abandoned",
            "attempt_acknowledged",
            "authenticated",
            "canceled",
            "denied",
            "informational",
            "internal_error",
            "not_supported",
            "processing_error",
            "rejected"
          ],
          "example": "authenticated"
        },
        "outcome_details": {
          "type": "object",
          "description": "Detailed authentication data. This field is required when the outcome is 'authenticated', 'informational', or 'attempt_acknowledged'.",
          "additionalProperties": false,
          "properties": {
            "three_ds_cryptogram": {
              "type": "string",
              "description": "The 3DS cryptogram (authentication value / AAV/CAVV/AEVV). This value is 20 bytes, base64-encoded into a 28-character string.",
              "example": "AbCdEfGhIjKlMnOpQrStUvWxY0="
            },
            "electronic_commerce_indicator": {
              "type": "string",
              "description": "Electronic Commerce Indicator (ECI) returned by the 3D Secure provider. Indicates the degree/type of authentication performed.",
              "enum": [
                "01",
                "02",
                "05",
                "06",
                "07"
              ],
              "example": "05"
            },
            "transaction_id": {
              "type": "string",
              "description": "Transaction identifier returned by the 3DS system:\n- For 3DS1: the XID\n- For 3DS2: the Directory Server Transaction ID (dsTransID)",
              "example": "dsTransId_abc123"
            },
            "version": {
              "type": "string",
              "description": "The 3D Secure version used for this authentication (for example '1.0.2' or '2.2.0').",
              "example": "2.2.0"
            }
          },
          "required": [
            "three_ds_cryptogram",
            "electronic_commerce_indicator",
            "transaction_id",
            "version"
          ]
        }
      },
      "required": [
        "outcome"
      ],
      "allOf": [
        {
          "if": {
            "properties": {
              "outcome": {
                "enum": [
                  "authenticated",
                  "informational",
                  "attempt_acknowledged"
                ]
              }
            }
          },
          "then": {
            "required": [
              "outcome_details"
            ]
          }
        }
      ]
    },
    "CheckoutSessionBase": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string"
        },
        "protocol": { "$ref": "#/$defs/ProtocolVersion" },
        "capabilities": {
          "$ref": "#/$defs/Capabilities"
        },
        "buyer": {
          "$ref": "#/$defs/Buyer"
        },
        "payment_provider": {
          "$ref": "#/$defs/PaymentProvider"
        },
        "payment": { "$ref": "#/$defs/PaymentResponse" },
        "status": {
          "type": "string",
          "enum": [
            "incomplete",
            "not_ready_for_payment",
            "requires_escalation",
            "authentication_required",
            "ready_for_payment",
            "pending_approval",
            "complete_in_progress",
            "completed",
            "canceled",
            "in_progress",
            "expired"
          ]
        },
        "currency": {
          "type": "string"
        },
        "presentment_currency": { "type": "string" },
        "exchange_rate": { "type": "number" },
        "exchange_rate_timestamp": { "type": "string", "format": "date-time" },
        "locale": { "type": "string" },
        "timezone": { "type": "string" },
        "line_items": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/LineItem"
          }
        },
        "fulfillment_details": {
          "$ref": "#/$defs/FulfillmentDetails"
        },
        "fulfillment_options": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "$ref": "#/$defs/FulfillmentOptionShipping"
              },
              {
                "$ref": "#/$defs/FulfillmentOptionDigital"
              },
              {
                "$ref": "#/$defs/FulfillmentOptionPickup"
              },
              {
                "$ref": "#/$defs/FulfillmentOptionLocalDelivery"
              }
            ]
          }
        },
        "selected_fulfillment_options": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/SelectedFulfillmentOptions"
          }
        },
        "fulfillment_groups": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/FulfillmentGroup"
          }
        },
        "fulfillment_groups": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/FulfillmentGroup"
          }
        },
        "totals": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Total"
          }
        },
        "messages": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "$ref": "#/$defs/MessageInfo"
              },
              {
                "$ref": "#/$defs/MessageWarning"
              },
              {
                "$ref": "#/$defs/MessageError"
              }
            ]
          }
        },
        "links": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Link"
          }
        },
        "authentication_metadata": {
          "$ref": "#/$defs/AuthenticationMetadata"
        },
        "created_at": { "type": "string", "format": "date-time" },
        "updated_at": { "type": "string", "format": "date-time" },
        "expires_at": { "type": "string", "format": "date-time" },
        "continue_url": { "type": "string", "format": "uri" },
        "metadata": {
          "type": "object",
          "additionalProperties": true
        },
        "quote_id": { "type": "string" },
        "quote_expires_at": { "type": "string", "format": "date-time" }
      },
      "required": [
        "id",
        "status",
        "currency",
        "line_items",
        "totals",
        "fulfillment_options",
        "messages",
        "links",
        "capabilities"
      ]
    },
    "CheckoutSession": {
      "allOf": [
        {
          "$ref": "#/$defs/CheckoutSessionBase"
        }
      ]
    },
    "CheckoutSessionWithOrder": {
      "allOf": [
        {
          "$ref": "#/$defs/CheckoutSessionBase"
        },
        {
          "type": "object",
          "properties": {
            "order": {
              "$ref": "#/$defs/Order"
            }
          },
          "required": ["order"]
        }
      ]
    },
    "CheckoutSessionCreateRequest": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "buyer": {
          "$ref": "#/$defs/Buyer"
        },
        "line_items": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Item"
          },
          "minItems": 1
        },
        "currency": { "type": "string", "description": "ISO 4217 currency code" },
        "fulfillment_details": {
          "$ref": "#/$defs/FulfillmentDetails"
        },
        "capabilities": {
          "$ref": "#/$defs/Capabilities"
        },
        "fulfillment_groups": {
          "type": "array",
          "items": { "$ref": "#/$defs/FulfillmentGroup" }
        },
        "affiliate_attribution": {
          "$ref": "#/$defs/AffiliateAttribution"
        },
        "coupons": {
          "type": "array",
          "items": { "type": "string" }
        },
        "locale": { "type": "string" },
        "timezone": { "type": "string" },
        "quote_id": { "type": "string" },
        "metadata": {
          "type": "object",
          "additionalProperties": true
        }
      },
      "required": ["line_items", "currency", "capabilities"]
    },
    "CheckoutSessionUpdateRequest": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "buyer": {
          "$ref": "#/$defs/Buyer"
        },
        "line_items": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Item"
          }
        },
        "fulfillment_details": {
          "$ref": "#/$defs/FulfillmentDetails"
        },
        "fulfillment_groups": {
          "type": "array",
          "items": { "$ref": "#/$defs/FulfillmentGroup" }
        },
        "selected_fulfillment_options": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/SelectedFulfillmentOptions"
          }
        },
        "coupons": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "CheckoutSessionCompleteRequest": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "buyer": {
          "$ref": "#/$defs/Buyer"
        },
        "payment_data": {
          "$ref": "#/$defs/PaymentData"
        },
        "authentication_result": {
          "$ref": "#/$defs/AuthenticationResult"
        },
        "affiliate_attribution": {
          "$ref": "#/$defs/AffiliateAttribution"
        },
        "risk_signals": { "$ref": "#/$defs/RiskSignals" }
      },
      "required": ["payment_data"]
    },
    "IntentTrace": {
      "type": "object",
      "properties": {
        "reason_code": {
          "type": "string",
          "description": "Reason for abandonment. This enum is extensible: servers SHOULD accept unrecognized values and treat them as 'other' (see RFC Section 7.2). Validators SHOULD be configured for lenient enum handling.",
          "enum": [
            "price_sensitivity",
            "shipping_cost",
            "shipping_speed",
            "product_fit",
            "trust_security",
            "returns_policy",
            "payment_options",
            "comparison",
            "timing_deferred",
            "other"
          ]
        },
        "trace_summary": {
          "type": "string",
          "maxLength": 500,
          "description": "A generated summary of the specific objection or negotiation gap."
        },
        "metadata": {
          "type": "object",
          "additionalProperties": {
            "type": ["string", "number", "boolean"]
          }
        }
      },
      "required": ["reason_code"]
    },
    "CancelSessionRequest": {
      "type": "object",
      "properties": {
        "intent_trace": {
          "$ref": "#/$defs/IntentTrace"
        }
      }
    },
    "Error": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "invalid_request",
            "request_not_idempotent",
            "processing_error",
            "service_unavailable"
          ]
        },
        "code": {
          "type": "string",
          "description": "Implementation-defined error code"
        },
        "message": {
          "type": "string"
        },
        "param": {
          "type": "string",
          "description": "RFC 9535 JSONPath (optional)"
        }
      },
      "required": ["type", "code", "message"]
    }
  }
}
